{"remainingRequest":"/Users/apple/Documents/hub/gchub/node_modules/babel-loader/lib/index.js!/Users/apple/Documents/hub/gchub/src/api/client.js","dependencies":[{"path":"/Users/apple/Documents/hub/gchub/src/api/client.js","mtime":1587998535889},{"path":"/Users/apple/Documents/hub/gchub/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/Documents/hub/gchub/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCB7IHNhdmVVc2VyRGV0YWlscyB9IGZyb20gJy4vdXNlcic7CmltcG9ydCBDbGllbnQgZnJvbSAnbGliLW9hdXRoMi1jbGllbnQtanMnOwpleHBvcnQgdmFyIGJhc2VVUkwgPSAnL2FwaS92MSc7CmV4cG9ydCB2YXIgdXBzdHJlYW1CYXNlVVJMID0gJ2h0dHBzOi8vZGV2dGVhbS5kZXYuZ2V0Y25zLnRlY2gvYXBpL3YxJzsKdmFyIHBob25lTnVtYmVyTmFtZSA9ICd4LXVzZXItcGhvbmUnOwp2YXIgdXNlcklkTmFtZSA9ICd4LXVzZXItaWQnOwp2YXIgY2xpZW50ID0gbmV3IENsaWVudCh7CiAgYXhpb3M6IHsKICAgIGJhc2VVUkw6IGJhc2VVUkwKICB9LAogIG9hdXRoOiB7CiAgICBjbGllbnRJRDogJzRiZDAzOGMxLTdhNWEtNGU1OS04MDY0LTBhM2FlMmMwNDllNicsCiAgICBlbmRwb2ludHM6IHsKICAgICAgYXV0aDogJ2h0dHBzOi8vYXV0aC50ZXN0MDEuZ2V0Y25zLnRlY2gvb2F1dGgyL2F1dGgnLAogICAgICB0b2tlbjogJ2h0dHBzOi8vYXV0aC50ZXN0MDEuZ2V0Y25zLnRlY2gvb2F1dGgyL3Rva2VuJwogICAgfSwKICAgIHJlZGlyZWN0VVJJOiAnaHR0cDovL2xvY2FsaG9zdDo4ODg4L2h1Yi9hdXRoLWNhbGxiYWNrJwogIH0KfSk7CmV4cG9ydCB2YXIgYXBpID0gY2xpZW50LmNyZWF0ZSh7CiAgYmFzZVVSTDogdXBzdHJlYW1CYXNlVVJMCn0pOwpjbGllbnQudXNlUmVzcG9uc2VJbnRlcmNlcHRvcihoYW5kbGVSZXNwb25zZSwgaGFuZGxlRXJyb3IpOwphcGkudXNlUmVzcG9uc2VJbnRlcmNlcHRvcihoYW5kbGVSZXNwb25zZSwgaGFuZGxlRXJyb3IpOwpleHBvcnQgdmFyIGh1YkFQSSA9IGNsaWVudDsKCmZ1bmN0aW9uIGhhbmRsZVJlc3BvbnNlKHIpIHsKICB2YXIgcGhvbmUgPSByLmhlYWRlcnNbcGhvbmVOdW1iZXJOYW1lXTsKICB2YXIgaWQgPSByLmhlYWRlcnNbdXNlcklkTmFtZV07CgogIGlmIChwaG9uZSkgewogICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocGhvbmVOdW1iZXJOYW1lLCBwaG9uZSk7CiAgfQoKICBpZiAoaWQpIHsKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHVzZXJJZE5hbWUsIGlkKTsKICB9CgogIHNhdmVVc2VyRGV0YWlscyhyKTsKICByZXR1cm4gcjsKfQoKZnVuY3Rpb24gaGFuZGxlRXJyb3IoZXJyKSB7CiAgaWYgKGVyci5yZXNwb25zZSkgcmV0dXJuIGhhbmRsZUVycm9yV2l0aFJlc3BvbnNlKGVycik7CiAgaWYgKGVyci5yZXF1ZXN0KSByZXR1cm4gaGFuZGxlRXJyb3JXaXRoUmVxdWVzdChlcnIpOwogIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpOwp9CgpmdW5jdGlvbiBoYW5kbGVFcnJvcldpdGhSZXNwb25zZShlcnIpIHsKICB2YXIgcmVzcCA9IGVyci5yZXNwb25zZTsKCiAgaWYgKHJlc3Auc3RhdHVzID09PSA0MDMpIHsKICAgIHZhciBuZXdFcnIgPSBuZXcgRXJyb3IocmVzcC5kYXRhLm1lc3NhZ2UpOwogICAgbmV3RXJyLnN1YmplY3QgPSByZXNwLmRhdGEuc3ViamVjdDsKICAgIG5ld0Vyci5hY3Rpb24gPSByZXNwLmRhdGEuYWN0aW9uOwogICAgbmV3RXJyLnJlc291cmNlID0gcmVzcC5kYXRhLnJlc291cmNlOwogICAgbmV3RXJyLnJvbGVzID0gcmVzcC5kYXRhLnJvbGVzOwogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ld0Vycik7CiAgfSAvLyB1bmF1dG9yaXplZAoKCiAgaWYgKHJlc3Auc3RhdHVzID09PSA0MDEpIHsKICAgIGNsaWVudC5sb2dpbigpOwogIH0KCiAgaWYgKHJlc3AuZGF0YSAmJiByZXNwLmRhdGEuY29kZSkgewogICAgdmFyIF9uZXdFcnIgPSBuZXcgRXJyb3IocmVzcC5kYXRhLm1lc3NhZ2UgfHwgcmVzcC5kYXRhLmVycm9yIHx8IGVyci5tZXNzYWdlIHx8IHJlc3AuZGF0YS5jb2RlLnRvU3RyaW5nKCkpOwoKICAgIF9uZXdFcnIuY29kZSA9IHJlc3AuZGF0YS5jb2RlOwogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9uZXdFcnIpOwogIH0KCiAgaWYgKHJlc3AuZGF0YS5lcnJvciAmJiByZXNwLmRhdGEuZXJyb3IuY29kZSkgewogICAgdmFyIF9uZXdFcnIyID0gbmV3IEVycm9yKHJlc3AuZGF0YS5lcnJvci5tZXNzYWdlIHx8IHJlc3AuZGF0YS5lcnJvci5zdGF0dXMgfHwgcmVzcC5kYXRhLmVycm9yKTsKCiAgICBfbmV3RXJyMi5jb2RlID0gcmVzcC5kYXRhLmVycm9yLmNvZGU7CiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX25ld0VycjIpOwogIH0KfQoKZnVuY3Rpb24gaGFuZGxlRXJyb3JXaXRoUmVxdWVzdChlcnIpIHsKICB2YXIgZGF0YSA9IHt9OwoKICB0cnkgewogICAgZGF0YSA9IEpTT04ucGFyc2UoZXJyLnJlcXVlc3QucmVzcG9uc2UpOwogIH0gY2F0Y2ggKGV4KSB7CiAgICBleC5vcmlnaW5hbEVycm9yID0gZXJyOwogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGV4KTsKICB9CgogIHZhciBuZXdFcnI7CgogIGlmIChkYXRhLmVycm9yKSB7CiAgICBuZXdFcnIgPSBuZXcgRXJyb3IoZGF0YS5lcnJvcik7CiAgfSBlbHNlIGlmIChkYXRhLm1lc3NhZ2UpIHsKICAgIG5ld0VyciA9IG5ldyBFcnJvcihkYXRhLm1lc3NhZ2UpOwogIH0gZWxzZSB7CiAgICBuZXdFcnIgPSBuZXcgRXJyb3IoZXJyLnJlcXVlc3QucmVzcG9uc2UpOwogIH0KCiAgaWYgKGRhdGEuY29kZSkgewogICAgbmV3RXJyLmNvZGUgPSBkYXRhLmNvZGU7CiAgfQoKICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3RXJyKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGN1cnJlbnRVc2VyUGhvbmUoKSB7CiAgaWYgKCFjbGllbnQudG9rZW4pIHJldHVybiAnJzsKICByZXR1cm4gY2xpZW50LnRva2VuLmlkLnVzZXJuYW1lOwp9CmV4cG9ydCBmdW5jdGlvbiBjdXJyZW50VXNlcklEKCkgewogIGlmICghY2xpZW50LnRva2VuKSByZXR1cm4gMDsKICByZXR1cm4gY2xpZW50LnRva2VuLmlkLnVzZXJJRDsKfQ=="},{"version":3,"sources":["/Users/apple/Documents/hub/gchub/src/api/client.js"],"names":["saveUserDetails","Client","baseURL","upstreamBaseURL","phoneNumberName","userIdName","client","axios","oauth","clientID","endpoints","auth","token","redirectURI","api","create","useResponseInterceptor","handleResponse","handleError","hubAPI","r","phone","headers","id","localStorage","setItem","err","response","handleErrorWithResponse","request","handleErrorWithRequest","Promise","reject","resp","status","newErr","Error","data","message","subject","action","resource","roles","login","code","error","toString","JSON","parse","ex","originalError","currentUserPhone","username","currentUserID","userID"],"mappings":"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","sourcesContent":["import { saveUserDetails } from './user'\nimport Client from 'lib-oauth2-client-js'\n\nexport const baseURL = '/api/v1'\nexport const upstreamBaseURL = 'https://devteam.dev.getcns.tech/api/v1'\n\nconst phoneNumberName = 'x-user-phone'\nconst userIdName = 'x-user-id'\n\nconst client = new Client({\n  axios: { baseURL },\n  oauth: {\n    clientID: '4bd038c1-7a5a-4e59-8064-0a3ae2c049e6',\n    endpoints: {\n      auth: 'https://auth.test01.getcns.tech/oauth2/auth',\n      token: 'https://auth.test01.getcns.tech/oauth2/token'\n    },\n    redirectURI: 'http://localhost:8888/hub/auth-callback'\n  }\n})\n\nexport const api = client.create({ baseURL: upstreamBaseURL })\n\nclient.useResponseInterceptor(handleResponse, handleError)\napi.useResponseInterceptor(handleResponse, handleError)\n\nexport const hubAPI = client\n\nfunction handleResponse (r) {\n  const phone = r.headers[phoneNumberName]\n  const id = r.headers[userIdName]\n\n  if (phone) {\n    localStorage.setItem(phoneNumberName, phone)\n  }\n  if (id) {\n    localStorage.setItem(userIdName, id)\n  }\n\n  saveUserDetails(r)\n  return r\n}\n\nfunction handleError (err) {\n  if (err.response) return handleErrorWithResponse(err)\n  if (err.request) return handleErrorWithRequest(err)\n  return Promise.reject(err)\n}\n\nfunction handleErrorWithResponse (err) {\n  const resp = err.response\n  if (resp.status === 403) {\n    const newErr = new Error(resp.data.message)\n    newErr.subject = resp.data.subject\n    newErr.action = resp.data.action\n    newErr.resource = resp.data.resource\n    newErr.roles = resp.data.roles\n    return Promise.reject(newErr)\n  }\n\n  // unautorized\n  if (resp.status === 401) {\n    client.login()\n  }\n\n  if (resp.data && resp.data.code) {\n    const newErr = new Error(resp.data.message || resp.data.error || err.message || resp.data.code.toString())\n    newErr.code = resp.data.code\n    return Promise.reject(newErr)\n  }\n\n  if (resp.data.error && resp.data.error.code) {\n    const newErr = new Error(resp.data.error.message || resp.data.error.status || resp.data.error)\n    newErr.code = resp.data.error.code\n    return Promise.reject(newErr)\n  }\n}\n\nfunction handleErrorWithRequest (err) {\n  let data = {}\n\n  try {\n    data = JSON.parse(err.request.response)\n  } catch (ex) {\n    ex.originalError = err\n    return Promise.reject(ex)\n  }\n\n  let newErr\n  if (data.error) {\n    newErr = new Error(data.error)\n  } else if (data.message) {\n    newErr = new Error(data.message)\n  } else {\n    newErr = new Error(err.request.response)\n  }\n\n  if (data.code) {\n    newErr.code = data.code\n  }\n  return Promise.reject(newErr)\n}\n\nexport function currentUserPhone () {\n  if (!client.token) return ''\n  return client.token.id.username\n}\n\nexport function currentUserID () {\n  if (!client.token) return 0\n  return client.token.id.userID\n}\n"]}]}